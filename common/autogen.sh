#!/bin/sh

pscnv_exist=$(lsmod | grep pscnv | wc -l)
nouveau_exist=$(lsmod | grep nouveau | wc -l)
nvidia_exist=$(lsmod | grep nvidia | wc -l)
driver=''

if [ ! $pscnv_exist -eq 0 ] ; then
	driver='pscnv'
	DRIVER='PSCNV'
elif [ ! $nouveau_exist -eq 0 ] ; then
	driver='nouveau'
	DRIVER='NOUVEAU'
elif [ ! $nvidia_exist -eq 0 ] ; then
	driver='nvi'
	DRIVER='NVI'
fi

echo "Detecting device driver... $driver"

# create Driver.mk
cat > Driver.mk << EOF
#
# Copyright (C) Shinpei Kato
# All Rights Reserved
#
# This is automatically generated by autogen.sh script.
#

DRIVER_NAME=$driver
EOF

# create gdev_autogen.h
cat > gdev_autogen.h << EOF
/*
 * Copyright (C) Shinpei Kato
 * All Rights Reserved
 *
 * This is automatically generated by autogen.sh script.
 *
 */

#define GDEV_DRIVER_$DRIVER
EOF
